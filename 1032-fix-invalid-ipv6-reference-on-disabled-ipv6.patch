From b94096dc7b5214c9f6e234b17d2e7e2ace758811 Mon Sep 17 00:00:00 2001
From: Stefan Guendhoer <stefan@guendhoer.com>
Date: Sat, 20 Feb 2016 15:57:11 +0100
Subject: [PATCH 1032/1168] fix invalid ipv6 reference on disabled ipv6

Former-commit-id: d7d37d3b218d5588ce00ded1e257c3e264f87a19
---
 .../connectivity/conn_soc/drv_wlan/mt_wifi/wlan/os/linux/gl_init.c   | 5 ++++-
 .../conn_soc/drv_wlan/mt_wifi/wlan/os/linux/gl_p2p_init.c            | 5 ++++-
 2 files changed, 8 insertions(+), 2 deletions(-)

diff --git a/drivers/misc/mediatek/connectivity/conn_soc/drv_wlan/mt_wifi/wlan/os/linux/gl_init.c b/drivers/misc/mediatek/connectivity/conn_soc/drv_wlan/mt_wifi/wlan/os/linux/gl_init.c
index 77068d4..1c0333e 100755
--- a/drivers/misc/mediatek/connectivity/conn_soc/drv_wlan/mt_wifi/wlan/os/linux/gl_init.c
+++ b/drivers/misc/mediatek/connectivity/conn_soc/drv_wlan/mt_wifi/wlan/os/linux/gl_init.c
@@ -2694,7 +2694,10 @@ void wlanHandleSystemSuspend(void)
 
         kalMemZero(g_aucBufIpAddr, sizeof(g_aucBufIpAddr));
 
-        prParamNetAddrList->u4AddressCount = u4NumIPv4 + u4NumIPv6;
+	prParamNetAddrList->u4AddressCount = u4NumIPv4;
+#ifdef  CONFIG_IPV6
+        prParamNetAddrList->u4AddressCount += u4NumIPv6;
+#endif
         prParamNetAddrList->u2AddressType = PARAM_PROTOCOL_ID_TCP_IP;
         for (i = 0; i < u4NumIPv4; i++) {
             prParamNetAddr->u2AddressLength = sizeof(PARAM_NETWORK_ADDRESS_IP);//4;;
diff --git a/drivers/misc/mediatek/connectivity/conn_soc/drv_wlan/mt_wifi/wlan/os/linux/gl_p2p_init.c b/drivers/misc/mediatek/connectivity/conn_soc/drv_wlan/mt_wifi/wlan/os/linux/gl_p2p_init.c
index 1817d49..a322128 100755
--- a/drivers/misc/mediatek/connectivity/conn_soc/drv_wlan/mt_wifi/wlan/os/linux/gl_p2p_init.c
+++ b/drivers/misc/mediatek/connectivity/conn_soc/drv_wlan/mt_wifi/wlan/os/linux/gl_p2p_init.c
@@ -220,7 +220,10 @@ void p2pHandleSystemSuspend(void)
 
         kalMemZero(g_aucBufIpAddr, sizeof(g_aucBufIpAddr));
 
-        prParamNetAddrList->u4AddressCount = u4NumIPv4 + u4NumIPv6;
+	prParamNetAddrList->u4AddressCount = u4NumIPv4;
+#ifdef  CONFIG_IPV6
+        prParamNetAddrList->u4AddressCount += u4NumIPv6;
+#endif
         prParamNetAddrList->u2AddressType = PARAM_PROTOCOL_ID_TCP_IP;
         for (i = 0; i < u4NumIPv4; i++) {
             prParamNetAddr->u2AddressLength = sizeof(PARAM_NETWORK_ADDRESS_IP);//4;;
-- 
2.7.4

