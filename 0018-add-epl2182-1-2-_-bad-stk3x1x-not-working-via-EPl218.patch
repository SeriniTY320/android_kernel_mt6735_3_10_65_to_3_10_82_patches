From 26f8d13e473ab9e1342c38d71406c5857fe20cf5 Mon Sep 17 00:00:00 2001
From: olegsvs <oleg.texet@gmail.com>
Date: Mon, 9 May 2016 15:25:33 +0300
Subject: [PATCH 018/117] add epl2182 1/2 _ bad - stk3x1x not working via
 EPl2182

---
 arch/arm64/configs/benefit_m7_defconfig            |  4 +-
 drivers/misc/mediatek/camera/camera/kd_camera_hw.h |  2 +-
 .../misc/mediatek/mach/mt6735/benefit_m7/Makefile  |  3 +
 .../benefit_m7/alsps/EPL2182-new/cust_alsps.c      | 62 ++++++++++---------
 .../mach/mt6735/benefit_m7/alsps/epl2182/Makefile  |  4 ++
 .../mt6735/benefit_m7/alsps/epl2182/cust_alsps.c   | 72 ++++++++++++++++++++++
 .../benefit_m7/alsps/stk3x1x_driver/cust_alsps.c   |  3 +-
 .../mt6735/benefit_m7/camera/camera/kd_camera_hw.h |  2 +-
 include/config/auto.conf                           |  1 +
 include/config/mtk/epl2182.h                       |  0
 include/config/mtk/epl2182/new.h                   |  0
 include/generated/autoconf.h                       |  1 +
 include/generated/compile.h                        |  4 +-
 tools/dct/DCT.log                                  | 25 --------
 14 files changed, 121 insertions(+), 62 deletions(-)
 create mode 100644 drivers/misc/mediatek/mach/mt6735/benefit_m7/alsps/epl2182/Makefile
 create mode 100644 drivers/misc/mediatek/mach/mt6735/benefit_m7/alsps/epl2182/cust_alsps.c
 create mode 100644 include/config/mtk/epl2182.h
 create mode 100644 include/config/mtk/epl2182/new.h

diff --git a/arch/arm64/configs/benefit_m7_defconfig b/arch/arm64/configs/benefit_m7_defconfig
index ca3a405..490d519 100644
--- a/arch/arm64/configs/benefit_m7_defconfig
+++ b/arch/arm64/configs/benefit_m7_defconfig
@@ -1286,8 +1286,8 @@ CONFIG_MTK_SIM2=y
 # CONFIG_MTK_CM36283 is not set
 # CONFIG_MTK_GP2AP002S00F is not set
 # CONFIG_MTK_APM_16D is not set
-CONFIG_MTK_EPL2182=y
-# CONFIG_MTK_EPL2182_NEW is not set
+# CONFIG_MTK_EPL2182 is not set //fc
+CONFIG_MTK_EPL2182_NEW=y
 CONFIG_MTK_STK3X1X_NEW=n
 CONFIG_MTK_STK3X1X_DRIVER=y
 # CONFIG_MTK_CM36652_NEW is not set
diff --git a/drivers/misc/mediatek/camera/camera/kd_camera_hw.h b/drivers/misc/mediatek/camera/camera/kd_camera_hw.h
index a9c33b6..d37afdf 100644
--- a/drivers/misc/mediatek/camera/camera/kd_camera_hw.h
+++ b/drivers/misc/mediatek/camera/camera/kd_camera_hw.h
@@ -45,7 +45,7 @@
  * Porting from wuzhiyong
 #define SUPPORT_I2C_BUS_NUM2        0
  */
-#define SUPPORT_I2C_BUS_NUM2        2
+#define SUPPORT_I2C_BUS_NUM2        0
 // End of Vanzo: yucheng
 
 #endif
diff --git a/drivers/misc/mediatek/mach/mt6735/benefit_m7/Makefile b/drivers/misc/mediatek/mach/mt6735/benefit_m7/Makefile
index d5ccbbc..fb6ac1e 100755
--- a/drivers/misc/mediatek/mach/mt6735/benefit_m7/Makefile
+++ b/drivers/misc/mediatek/mach/mt6735/benefit_m7/Makefile
@@ -50,6 +50,9 @@ ifeq ($(CONFIG_MTK_STK3X1X_DRIVER),y)
 obj-y	+=  alsps/stk3x1x_driver/
 endif
 
+ifeq ($(CONFIG_MTK_EPL2182_NEW),y)
+obj-y	+=  alsps/epl2182/
+endif
 ifeq ($(CONFIG_MTK_MMC3416X),y)
 obj-y   +=  magnetometer/mmc3416x/
 endif
diff --git a/drivers/misc/mediatek/mach/mt6735/benefit_m7/alsps/EPL2182-new/cust_alsps.c b/drivers/misc/mediatek/mach/mt6735/benefit_m7/alsps/EPL2182-new/cust_alsps.c
index 21c417d..0032db1 100644
--- a/drivers/misc/mediatek/mach/mt6735/benefit_m7/alsps/EPL2182-new/cust_alsps.c
+++ b/drivers/misc/mediatek/mach/mt6735/benefit_m7/alsps/EPL2182-new/cust_alsps.c
@@ -6,46 +6,48 @@
  #if defined(CONFIG_T93E_TS_PROJ)
   #define PS_HIGH 0X3E8
   #define PS_LOW  0x320
- #elif defined(CONFIG_T93T_5512_PROJ)
-  #define PS_HIGH 0X44c
-  #define PS_LOW  0x41a
  #elif defined(CONFIG_T93Q_LF_PROJ)
   #define PS_HIGH 0X352
   #define PS_LOW  0x320
- #elif defined(CONFIG_T93H_KLT_PROJ)
- #if defined(CONFIG_T93H_KLT_BOM22_PROJ)
-  #define PS_HIGH 700
-  #define PS_LOW  600
- #else
-  #define PS_HIGH 0X44c
-  #define PS_LOW  0x41a
- #endif
- #elif defined(CONFIG_T93BM_DG_PROJ)
-  #define PS_HIGH 1000
-  #define PS_LOW  900
  #else
   #define PS_HIGH 0X226
   #define PS_LOW  0x210
  #endif
-#elif defined(CONFIG_T25_PROJ)
-	#define PS_HIGH 850
-	#define PS_LOW  700
-#elif defined(CONFIG_T99C_JQ_PROJ)
-	#define PS_HIGH 500
-	#define PS_LOW  250
+#endif
+
+#if defined(CONFIG_T89P_YX_PROJ)
+ #define PS_HIGH 2400
+ #define PS_LOW  2300
+#endif
 
-#elif defined(CONFIG_T99F_LF_PROJ)
+#if defined(CONFIG_T985B_DWS_PROJ)
  #define PS_HIGH 3000
  #define PS_LOW  2000
-#elif defined(CONFIG_T89D_KLT_PROJ)
-	#define PS_HIGH 1200
-	#define PS_LOW  1000
-#elif defined(CONFIG_T89J_JK_PROJ)
-	#define PS_HIGH 1088
-	#define PS_LOW  416
-#else
-#define PS_HIGH 0X1200
-#define PS_LOW  0x1000
+#endif
+
+#if defined(CONFIG_T99G_DH_PROJ)
+ #define PS_HIGH 1800
+ #define PS_LOW  700
+#endif
+
+#if defined(CONFIG_T99F_LF_PROJ)
+ #define PS_HIGH 3000
+ #define PS_LOW  2000
+#endif
+
+#if defined(CONFIG_T99L_DWS_PROJ)
+ #define PS_HIGH 3000
+ #define PS_LOW  2000
+#endif
+
+#if defined(CONFIG_T991_PROJ)
+ #define PS_HIGH 2800
+ #define PS_LOW  2500
+#endif
+
+#ifndef PS_HIGH
+ #define PS_HIGH 0X1200
+ #define PS_LOW  0x1000
 #endif
 
 static struct alsps_hw cust_alsps_hw = {
diff --git a/drivers/misc/mediatek/mach/mt6735/benefit_m7/alsps/epl2182/Makefile b/drivers/misc/mediatek/mach/mt6735/benefit_m7/alsps/epl2182/Makefile
new file mode 100644
index 0000000..b9b1943
--- /dev/null
+++ b/drivers/misc/mediatek/mach/mt6735/benefit_m7/alsps/epl2182/Makefile
@@ -0,0 +1,4 @@
+include $(srctree)/drivers/misc/mediatek/Makefile.custom
+
+obj-y	:=  cust_alsps.o
+
diff --git a/drivers/misc/mediatek/mach/mt6735/benefit_m7/alsps/epl2182/cust_alsps.c b/drivers/misc/mediatek/mach/mt6735/benefit_m7/alsps/epl2182/cust_alsps.c
new file mode 100644
index 0000000..9e6dd52
--- /dev/null
+++ b/drivers/misc/mediatek/mach/mt6735/benefit_m7/alsps/epl2182/cust_alsps.c
@@ -0,0 +1,72 @@
+#include <linux/types.h>
+#include <mach/mt_pm_ldo.h>
+#include <cust_alsps.h>
+#include <mach/upmu_common.h>
+#if defined(CONFIG_T93_PROJ)
+ #if defined(CONFIG_T93E_TS_PROJ)
+  #define PS_HIGH 0X3E8
+  #define PS_LOW  0x320
+ #elif defined(CONFIG_T93Q_LF_PROJ)
+  #define PS_HIGH 0X352
+  #define PS_LOW  0x320
+ #else
+  #define PS_HIGH 0X226
+  #define PS_LOW  0x210
+ #endif
+#endif
+
+#if defined(CONFIG_T89P_YX_PROJ)
+ #define PS_HIGH 2400
+ #define PS_LOW  2300
+#endif
+
+#if defined(CONFIG_T985B_DWS_PROJ)
+ #define PS_HIGH 3000
+ #define PS_LOW  2000
+#endif
+
+#if defined(CONFIG_T99G_DH_PROJ)
+ #define PS_HIGH 1800
+ #define PS_LOW  700
+#endif
+
+#if defined(CONFIG_T99F_LF_PROJ)
+ #define PS_HIGH 3000
+ #define PS_LOW  2000
+#endif
+
+#if defined(CONFIG_T99L_DWS_PROJ)
+ #define PS_HIGH 3000
+ #define PS_LOW  2000
+#endif
+
+#if defined(CONFIG_T991_PROJ)
+ #define PS_HIGH 2800
+ #define PS_LOW  2500
+#endif
+
+#ifndef PS_HIGH
+ #define PS_HIGH 0X1200
+ #define PS_LOW  0x1000
+#endif
+
+static struct alsps_hw cust_alsps_hw = {
+    .i2c_num    = 2,
+	.polling_mode_ps =0,
+	.polling_mode_als =1,
+    .power_id   = MT65XX_POWER_NONE,    /*LDO is not used*/
+    .power_vol  = VOL_DEFAULT,          /*LDO is not used*/
+   // .i2c_addr   = {0x49, 0x00, 0x00, 0x00},
+
+    /* MTK: modified to support AAL */
+	.als_level	= {5, 8, 16, 32, 60, 90, 140, 180, 400, 900, 4000, 7000, 8000, 10000, 20000},
+	.als_value	= {0, 10, 20, 40, 90, 120, 160, 225, 280, 360, 640, 1280, 2600, 3800, 4700, 10240},
+    .ps_threshold_high = PS_HIGH,
+    .ps_threshold_low = PS_LOW,
+    .is_batch_supported_ps = false,
+    .is_batch_supported_als = false,
+};
+struct alsps_hw *get_cust_alsps_hw(void) {
+    return &cust_alsps_hw;
+}
+
diff --git a/drivers/misc/mediatek/mach/mt6735/benefit_m7/alsps/stk3x1x_driver/cust_alsps.c b/drivers/misc/mediatek/mach/mt6735/benefit_m7/alsps/stk3x1x_driver/cust_alsps.c
index c6a673e..3b3af12 100644
--- a/drivers/misc/mediatek/mach/mt6735/benefit_m7/alsps/stk3x1x_driver/cust_alsps.c
+++ b/drivers/misc/mediatek/mach/mt6735/benefit_m7/alsps/stk3x1x_driver/cust_alsps.c
@@ -46,7 +46,8 @@ static struct alsps_hw cust_alsps_hw = {
 	.polling_mode_als =1,   
     .power_id   = MT65XX_POWER_NONE,    /*LDO is not used*/
     .power_vol  = VOL_DEFAULT,          /*LDO is not used*/
-    .i2c_addr   = {0x90, 0x00, 0x00, 0x00},	/*STK3x1x*/
+    .i2c_addr   = {0x48, 0x00, 0x00, 0x00},	/*STK3x1x*/
+   // .i2c_addr   = {0x48, 0x00, 0x00, 0x00},	/*STK3x1x*/
     .als_level  = {5, 9, 36, 59, 82, 132, 205, 273, 500, 845, 1136, 1545, 2364, 4655, 6982},	/* als_code */
     .als_value  = {10, 10, 40, 65, 90, 145, 225, 300, 550, 930, 1250, 1700, 2600, 5120, 7680, 10240 },    /* lux */
    	.state_val = 0x0,		/* disable all */
diff --git a/drivers/misc/mediatek/mach/mt6735/benefit_m7/camera/camera/kd_camera_hw.h b/drivers/misc/mediatek/mach/mt6735/benefit_m7/camera/camera/kd_camera_hw.h
index a9c33b6..d37afdf 100755
--- a/drivers/misc/mediatek/mach/mt6735/benefit_m7/camera/camera/kd_camera_hw.h
+++ b/drivers/misc/mediatek/mach/mt6735/benefit_m7/camera/camera/kd_camera_hw.h
@@ -45,7 +45,7 @@
  * Porting from wuzhiyong
 #define SUPPORT_I2C_BUS_NUM2        0
  */
-#define SUPPORT_I2C_BUS_NUM2        2
+#define SUPPORT_I2C_BUS_NUM2        0
 // End of Vanzo: yucheng
 
 #endif
diff --git a/include/config/auto.conf b/include/config/auto.conf
index 52be552..3453e17 100644
--- a/include/config/auto.conf
+++ b/include/config/auto.conf
@@ -240,6 +240,7 @@ CONFIG_ANDROID_LOW_MEMORY_KILLER_AUTODETECT_OOM_ADJ_VALUES=y
 CONFIG_INET_IPCOMP=y
 CONFIG_OF_NET=y
 CONFIG_ARM_ARCH_TIMER=y
+CONFIG_MTK_EPL2182_NEW=y
 CONFIG_EVENT_TRACING=y
 CONFIG_HID_CYPRESS=y
 CONFIG_ARCH_WANT_OPTIONAL_GPIOLIB=y
diff --git a/include/config/mtk/epl2182.h b/include/config/mtk/epl2182.h
new file mode 100644
index 0000000..e69de29
diff --git a/include/config/mtk/epl2182/new.h b/include/config/mtk/epl2182/new.h
new file mode 100644
index 0000000..e69de29
diff --git a/include/generated/autoconf.h b/include/generated/autoconf.h
index bec13ab..97d9122 100644
--- a/include/generated/autoconf.h
+++ b/include/generated/autoconf.h
@@ -242,6 +242,7 @@
 #define CONFIG_INET_IPCOMP 1
 #define CONFIG_OF_NET 1
 #define CONFIG_ARM_ARCH_TIMER 1
+#define CONFIG_MTK_EPL2182_NEW 1
 #define CONFIG_EVENT_TRACING 1
 #define CONFIG_HID_CYPRESS 1
 #define CONFIG_ARCH_WANT_OPTIONAL_GPIOLIB 1
diff --git a/include/generated/compile.h b/include/generated/compile.h
index 57068cc..3e897d7 100644
--- a/include/generated/compile.h
+++ b/include/generated/compile.h
@@ -1,7 +1,7 @@
-/* This file is auto generated, version 75 */
+/* This file is auto generated, version 82 */
 /* SMP PREEMPT */
 #define UTS_MACHINE "arm64"
-#define UTS_VERSION "#75 SMP PREEMPT Sun May 8 22:58:11 MSK 2016"
+#define UTS_VERSION "#82 SMP PREEMPT Mon May 9 15:11:34 MSK 2016"
 #define LINUX_COMPILE_BY "olegsvs"
 #define LINUX_COMPILE_HOST "olegsvs-develop"
 #define LINUX_COMPILER "gcc version 4.9 20150123 (prerelease) (GCC) "
diff --git a/tools/dct/DCT.log b/tools/dct/DCT.log
index 4e5e630..e69de29 100644
--- a/tools/dct/DCT.log
+++ b/tools/dct/DCT.log
@@ -1,25 +0,0 @@
-/* Log generated by MTK SP DrvGen Version 03.13.6;
- Log Time is Sun May 08 19:38:14 2016
- */
-open operater parse MT6735M.fig OK!
-Edit operater parse .cmp file OK!
-open operater parse MT6753.fig OK!
-Edit operater parse .cmp file OK!
-open operater parse MT6735.fig OK!
-Edit operater parse .cmp file OK!
-open operater parse MT6735M.fig OK!
-Edit operater parse .cmp file OK!
-Edit operater parse .cmp file OK!
-open operater parse MT6735M.fig OK!
-Edit operater parse .cmp file OK!
-Gencode operater parse .cmp file OK!
-Gencode cust_eint_md1.h OK!
-Gencode cust_power.h OK!
-Edit operater parse .cmp file OK!
-open operater parse MT6753.fig OK!
-Edit operater parse .cmp file OK!
-open operater parse MT6735M.fig OK!
-Edit operater parse .cmp file OK!
-Gencode operater parse .cmp file OK!
-Gencode cust_eint_md1.h OK!
-Gencode cust_power.h OK!
-- 
2.7.4

